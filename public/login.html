<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tax Kaki AI Login</title>
  <style>
    body { 
      background: #f5f7fb; 
      font-family: "Segoe UI", Arial, sans-serif; 
      margin: 0; 
      padding: 0;
    }
    .container { 
      max-width: 370px; 
      margin: 70px auto; 
      background: #fff; 
      border-radius: 12px; 
      box-shadow: 0 8px 24px rgba(32,38,45,.07); 
      padding: 38px 30px 28px 30px;
    }
    h2 { 
      color: #002b5c; 
      margin-bottom: 20px; 
      text-align: center;
    }
    label { 
      display: block; 
      margin: 10px 0 5px; 
      color: #133b6f;
      font-weight: 500;
    }
    input { 
      width: 100%; 
      font-size: 1em; 
      padding: 10px 11px; 
      margin-bottom: 18px; 
      border-radius: 6px; 
      border: 1px solid #dce2ec; 
      background: #f4f6fa;
      box-sizing: border-box;
    }
    input:focus {
      outline: none;
      border-color: #002b5c;
      background: #fff;
    }
    .btn-row {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }
    button { 
      flex: 1;
      background: #002b5c; 
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      padding: 13px 0; 
      font-size: 1.08em; 
      cursor: pointer;
      transition: background 0.3s;
      font-weight: 500;
    }
    button:hover {
      background: #004080;
    }
    button:disabled {
      background: #6b7280;
      cursor: not-allowed;
    }
    .signup-btn {
      background: #b42531;
    }
    .signup-btn:hover {
      background: #d12d40;
    }
    .msg { 
      text-align: center; 
      color: #952222; 
      margin-bottom: 13px;
      min-height: 20px;
      font-size: 0.95em;
    }
    .msg.success {
      color: #059669;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Access Tax Kaki AI</h2>
    <form id="loginform" onsubmit="event.preventDefault(); doLogin();">
      <label for="pan">Enter your PAN</label>
      <input 
        id="pan" 
        maxlength="10" 
        autocomplete="off" 
        placeholder="ABCDE1234F" 
        required
      >
      
      <label for="pin">Enter 4-digit PIN</label>
      <input 
        id="pin" 
        maxlength="4" 
        type="password" 
        pattern="[0-9]{4}" 
        autocomplete="off" 
        placeholder="****"
        required
      >
      
      <div class="msg" id="msg"></div>
      <div class="btn-row">
        <button type="submit" id="loginBtn">Login for existing users</button>
        <button type="button" class="signup-btn" onclick="window.location.href='signup.html';">Signup for new users</button>
      </div>
    </form>
  </div>

  <script>
    async function doLogin() {
      const pan = document.getElementById('pan').value.trim().toUpperCase();
      const pin = document.getElementById('pin').value.trim();
      const msg = document.getElementById('msg');
      const loginBtn = document.getElementById('loginBtn');

      // Basic validation
      if (!pan || !pin) {
        msg.textContent = "Please enter both PAN and PIN";
        msg.className = "msg";
        return;
      }

      if (pan.length !== 10) {
        msg.textContent = "PAN must be 10 characters";
        msg.className = "msg";
        return;
      }

      if (pin.length !== 4) {
        msg.textContent = "PIN must be 4 digits";
        msg.className = "msg";
        return;
      }

      // Show loading state
      msg.textContent = "Logging in...";
      msg.className = "msg";
      loginBtn.disabled = true;
      loginBtn.textContent = "Please wait...";

      try {
        // Call backend /login endpoint
        const res = await fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ pan, pin })
        });

        const data = await res.json();

        if (res.ok && data.status === "ok") {
          // Login successful
          msg.textContent = "Login successful! Redirecting...";
          msg.className = "msg success";
          
          // Save PAN to localStorage
          localStorage.setItem("taxkaki-pan", pan);
          
          // Redirect to main page
          setTimeout(() => {
            window.location.href = "index.html";
          }, 500);
        } else {
          // Login failed - show error from server
          msg.textContent = data.error || "Invalid credentials";
          msg.className = "msg";
          loginBtn.disabled = false;
          loginBtn.textContent = "Login for existing users";
        }
      } catch (error) {
        // Network or server error
        console.error('Login error:', error);
        msg.textContent = "Connection error. Please try again.";
        msg.className = "msg";
        loginBtn.disabled = false;
        loginBtn.textContent = "Login for existing users";
      }
    }

    // Allow pressing Enter to submit
    document.getElementById('pin').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        doLogin();
      }
    });
  </script>
</body>
</html>
